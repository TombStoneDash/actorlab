import Stripe from "stripe"; export default async function h(req,res){ if(req.method!=="POST") return res.status(405).end(); const s=new Stripe(process.env.STRIPE_SECRET_KEY!,{apiVersion:"2023-10-16"}); const customerId=req.body?.customerId; if(!customerId) return res.status(400).json({error:"Customer ID required"}); const portal=await s.billingPortal.sessions.create({customer:customerId, return_url:`${process.env.NEXT_PUBLIC_BASE_URL}/account`}); res.redirect(303, portal.url); }
